<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-0.7.0 plugin-docs plugin-id-default docs-doc-id-guides/Guide_31_Using_redpanda_to_test_fastkafka">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Using Redpanda to test FastKafka | FastKafka</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://opengraph.githubassets.com/1671805243.560327/airtai/fastkafka"><meta data-rh="true" name="twitter:image" content="https://opengraph.githubassets.com/1671805243.560327/airtai/fastkafka"><meta data-rh="true" property="og:url" content="https://fastkafka.airt.ai/docs/0.7.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.7.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.7.0"><meta data-rh="true" name="docsearch:version" content="0.7.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.7.0"><meta data-rh="true" property="og:title" content="Using Redpanda to test FastKafka | FastKafka"><meta data-rh="true" name="description" content="What is FastKafka?"><meta data-rh="true" property="og:description" content="What is FastKafka?"><link data-rh="true" rel="icon" href="/img/AIRT_icon_blue.svg"><link data-rh="true" rel="canonical" href="https://fastkafka.airt.ai/docs/0.7.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/"><link data-rh="true" rel="alternate" href="https://fastkafka.airt.ai/docs/0.7.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/" hreflang="en"><link data-rh="true" rel="alternate" href="https://fastkafka.airt.ai/docs/0.7.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EHYNSIUGMY-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WLMWPELHMB"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WLMWPELHMB",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="FastKafka" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.4f0d6495.css">
<link rel="preload" href="/assets/js/runtime~main.2d54bb54.js" as="script">
<link rel="preload" href="/assets/js/main.23419ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://airt.ai" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/AIRT_icon_blue.svg" alt="airt logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/AIRT_icon_blue.svg" alt="airt logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">airt</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link fastkafka-home navbar__link--active" href="/"><div><img src="/img/home-icon.svg"><p>FastKafka</p></div></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/0.7.0/">0.7.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/guides/Guide_31_Using_redpanda_to_test_fastkafka/">dev ðŸš§</a></li><li><a class="dropdown__link" href="/docs/guides/Guide_31_Using_redpanda_to_test_fastkafka/">0.8.0</a></li><li><a class="dropdown__link" href="/docs/0.7.1/guides/Guide_31_Using_redpanda_to_test_fastkafka/">0.7.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.7.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/">0.7.0</a></li><li><a class="dropdown__link" href="/docs/0.6.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/">0.6.0</a></li><li><a class="dropdown__link" href="/docs/0.5.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/">0.5.0</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/0.7.0/">Docs</a><div class="navbar__item github-stars"><iframe src="https://ghbtns.com/github-btn.html?user=airtai&repo=fastkafka&type=star&count=true&size=large" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe></div><a href="https://discord.gg/CJWmYpyFbc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Discord Link"></a><a aria-current="page" class="navbar__item navbar__link fastkafka-home-mobile navbar__link--active" href="/"><div><img src="/img/home-icon.svg"></div></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.7.0/">FastKafka</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/0.7.0/guides/Guide_11_Consumes_Basics/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/0.7.0/guides/Guide_11_Consumes_Basics/">Writing services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/0.7.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/">Testing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/0.7.0/guides/Guide_31_Using_redpanda_to_test_fastkafka/">Using Redpanda to test FastKafka</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/0.7.0/guides/Guide_04_Github_Actions_Workflow/">Documentation generation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/0.7.0/guides/Guide_30_Using_docker_to_deploy_fastkafka/">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/0.7.0/guides/Guide_06_Benchmarking_FastKafka/">Benchmarking</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/0.7.0/api/fastkafka/EventMetadata/">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/0.7.0/cli/fastkafka/">CLI</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.7.0/LICENSE/">LICENSE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.7.0/CONTRIBUTING/">Contributing to fastkafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/0.7.0/CHANGELOG/">Release notes</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->FastKafka<!-- --> <b>0.7.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/guides/Guide_31_Using_redpanda_to_test_fastkafka/">latest version</a></b> (<!-- -->0.8.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Testing</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Using Redpanda to test FastKafka</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.7.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Using Redpanda to test FastKafka</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-fastkafka">What is FastKafka?<a href="#what-is-fastkafka" class="hash-link" aria-label="Direct link to What is FastKafka?" title="Direct link to What is FastKafka?">â€‹</a></h2><p><a href="https://fastkafka.airt.ai/" target="_blank" rel="noopener noreferrer">FastKafka</a> is a powerful and easy-to-use
Python library for building asynchronous services that interact with
Kafka topics. Built on top of <a href="https://docs.pydantic.dev/" target="_blank" rel="noopener noreferrer">Pydantic</a>,
<a href="https://github.com/aio-libs/aiokafka" target="_blank" rel="noopener noreferrer">AIOKafka</a> and
<a href="https://www.asyncapi.com/" target="_blank" rel="noopener noreferrer">AsyncAPI</a>, FastKafka simplifies the process
of writing producers and consumers for Kafka topics, handling all the
parsing, networking, task scheduling and data generation automatically.
With FastKafka, you can quickly prototype and develop high-performance
Kafka-based services with minimal code, making it an ideal choice for
developers looking to streamline their workflow and accelerate their
projects.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-redpanda">What is Redpanda?<a href="#what-is-redpanda" class="hash-link" aria-label="Direct link to What is Redpanda?" title="Direct link to What is Redpanda?">â€‹</a></h2><p>Redpanda is a drop-in replacement for Kafka. Most of the Kafka tools
work out of the box with Redpanda.</p><p>From <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">redpanda.com</a>:</p><blockquote><p>Redpanda is a KafkaÂ®-compatible streaming data platform that is proven
to be 10x faster and 6x lower in total costs. It is also JVM-free,
ZooKeeperÂ®-free, Jepsen-tested and source available.</p></blockquote><p>Some of the advantages of Redpanda over Kafka are</p><ol><li>A single binary with built-in everything, no ZooKeeperÂ® or JVM
needed.</li><li>Costs upto 6X less than Kafka.</li><li>Up to 10x lower average latencies and up to 6x faster Kafka
transactions without compromising correctness.</li></ol><p>To learn more about Redpanda, please visit their
<a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">website</a> or checkout this <a href="https://redpanda.com/blog/redpanda-vs-kafka-performance-benchmark" target="_blank" rel="noopener noreferrer">blog
post</a>
comparing Redpanda and Kafkaâ€™s performance benchmarks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-repo">Example repo<a href="#example-repo" class="hash-link" aria-label="Direct link to Example repo" title="Direct link to Example repo">â€‹</a></h2><p>A sample fastkafka-based library that uses Redpanda for testing, based
on this guide, can be found
<a href="https://github.com/airtai/sample_fastkafka_with_redpanda" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-process">The process<a href="#the-process" class="hash-link" aria-label="Direct link to The process" title="Direct link to The process">â€‹</a></h2><p>Here are the steps weâ€™ll be walking through to build our example:</p><ol><li>Set up the prerequisites.</li><li>Clone the example repo.</li><li>Explain how to write an application using FastKafka.</li><li>Explain how to write a test case to test FastKafka with Redpanda.</li><li>Run the test case and produce/consume messages.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-prerequisites">1. Prerequisites<a href="#1-prerequisites" class="hash-link" aria-label="Direct link to 1. Prerequisites" title="Direct link to 1. Prerequisites">â€‹</a></h2><p>Before starting, make sure you have the following prerequisites set up:</p><ol><li><strong>Python 3.x</strong>: A Python 3.x installation is required to run
FastKafka. You can download the latest version of Python from the
<a href="https://www.python.org/downloads/" target="_blank" rel="noopener noreferrer">official website</a>. Youâ€™ll also
need to have pip installed and updated, which is Pythonâ€™s package
installer.</li><li><strong>Docker Desktop</strong>: Docker is used to run Redpanda, which is
required for testing FastKafka. You can download and install Docker
Desktop from the <a href="https://www.docker.com/products/docker-desktop/" target="_blank" rel="noopener noreferrer">official
website</a>.</li><li><strong>Git</strong>: Youâ€™ll need to have Git installed to clone the example
repo. You can download Git from the <a href="https://git-scm.com/downloads" target="_blank" rel="noopener noreferrer">official
website</a>.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-cloning-and-setting-up-the-example-repo">2. Cloning and setting up the example repo<a href="#2-cloning-and-setting-up-the-example-repo" class="hash-link" aria-label="Direct link to 2. Cloning and setting up the example repo" title="Direct link to 2. Cloning and setting up the example repo">â€‹</a></h2><p>To get started with the example code, clone the <a href="https://github.com/airtai/sample_fastkafka_with_redpanda" target="_blank" rel="noopener noreferrer">GitHub
repository</a> by
running the following command in your terminal:</p><div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/airtai/sample_fastkafka_with_redpanda.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd sample_fastkafka_with_redpanda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will create a new directory called sample_fastkafka_with_redpanda
and download all the necessary files.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-virtual-environment">Create a virtual environment<a href="#create-a-virtual-environment" class="hash-link" aria-label="Direct link to Create a virtual environment" title="Direct link to Create a virtual environment">â€‹</a></h3><p>Before writing any code, letâ€™s <a href="https://docs.python.org/3/library/venv.html#module-venv" target="_blank" rel="noopener noreferrer">create a new virtual
environment</a>
for our project.</p><p>A virtual environment is an isolated environment for a Python project,
which allows you to manage project-specific dependencies and avoid
conflicts between different projects.</p><p>To create a new virtual environment, run the following commands in your
terminal:</p><div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m venv venv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will create a new directory called <code>venv</code> in your project
directory, which will contain the virtual environment.</p><p>To activate the virtual environment, run the following command:</p><div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source venv/bin/activate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will change your shellâ€™s prompt to indicate that you are now
working inside the virtual environment.</p><p>Finally, run the following command to upgrade <code>pip</code>, the Python package
installer:</p><div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --upgrade pip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-python-dependencies">Install Python dependencies<a href="#install-python-dependencies" class="hash-link" aria-label="Direct link to Install Python dependencies" title="Direct link to Install Python dependencies">â€‹</a></h3><p>Next, letâ€™s install the required Python dependencies. In this guide,
weâ€™ll be using <code>FastKafka</code> to write our application code and <code>pytest</code>
and <code>pytest-asyncio</code> to test it.</p><p>You can install the dependencies from the <code>requirements.txt</code> file
provided in the cloned repository by running:</p><div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install -r requirements.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will install all the required packages and their dependencies.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-writing-server-code">3. Writing server code<a href="#3-writing-server-code" class="hash-link" aria-label="Direct link to 3. Writing server code" title="Direct link to 3. Writing server code">â€‹</a></h2><p>The <code>application.py</code> file in the cloned repository demonstrates how to
use FastKafka to consume messages from a Kafka topic, make predictions
using a predictive model, and publish the predictions to another Kafka
topic. Here is an explanation of the code:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparing-the-demo-model">Preparing the demo model<a href="#preparing-the-demo-model" class="hash-link" aria-label="Direct link to Preparing the demo model" title="Direct link to Preparing the demo model">â€‹</a></h3><p>First we will prepare our model using the Iris dataset so that we can
demonstrate the predictions using FastKafka. The following call
downloads the dataset and trains the model.</p><p>We will wrap the model creation into a lifespan of our app so that the
model is created just before the app is started.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> contextlib </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> asynccontextmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> load_iris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linear_model </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> LogisticRegression</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ml_models </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@asynccontextmanager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">lifespan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Load the ML model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">return_X_y</span><span class="token operator" style="color:#D73A49">=</span><span class="token boolean" style="color:#005CC5">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ml_models</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;iris_predictor&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> LogisticRegression</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">random_state</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_iter</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">yield</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Clean up the ML models and release the resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ml_models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="messages">Messages<a href="#messages" class="hash-link" aria-label="Direct link to Messages" title="Direct link to Messages">â€‹</a></h3><p>FastKafka uses <a href="https://docs.pydantic.dev/" target="_blank" rel="noopener noreferrer">Pydantic</a> to parse input
JSON-encoded data into Python objects, making it easy to work with
structured data in your Kafka-based applications. Pydanticâ€™s
<a href="https://docs.pydantic.dev/usage/models/" target="_blank" rel="noopener noreferrer"><code>BaseModel</code></a> class allows you
to define messages using a declarative syntax, making it easy to specify
the fields and types of your messages.</p><p>This example defines two message classes for use in a FastKafka
application:</p><ul><li><p>The <code>IrisInputData</code> class is used to represent input data for a
predictive model. It has four fields of type
<a href="https://docs.pydantic.dev/latest/api/types/#pydantic.types.NonNegativeFloat" target="_blank" rel="noopener noreferrer"><code>NonNegativeFloat</code></a>,
which is a subclass of float that only allows non-negative floating
point values.</p></li><li><p>The <code>IrisPrediction</code> class is used to represent the output of the
predictive model. It has a single field <code>species</code> of type string
representing the predicted species.</p></li></ul><p>These message classes will be used to parse and validate incoming data
in Kafka consumers and producers.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NonNegativeFloat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">IrisInputData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Sepal length in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Sepal width in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Petal length in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Petal width in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">IrisPrediction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    species</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">str</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;setosa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Predicted species&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application">Application<a href="#application" class="hash-link" aria-label="Direct link to Application" title="Direct link to Application">â€‹</a></h3><p>This example shows how to initialize a FastKafka application.</p><p>It starts by defining a dictionary called <code>kafka_brokers</code>, which
contains two entries: <code>&quot;localhost&quot;</code> and <code>&quot;production&quot;</code>, specifying local
development and production Kafka brokers. Each entry specifies the URL,
port, and other details of a Kafka broker. This dictionary is used both
to generate documentation and to later run the server against one of the
given kafka broker.</p><p>Next, an instance of the <code>FastKafka</code> class is initialized with the
minimum required arguments:</p><ul><li><code>kafka_brokers</code>: a dictionary used for generating documentation</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#C6105F">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;local development kafka broker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;port&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#C6105F">&quot;production&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kafka.airt.ai&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;production kafka broker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;port&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;protocol&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kafka-secure&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;security&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#C6105F">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;plain&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_app </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Iris predictions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kafka_brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lifespan</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">lifespan</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="function-decorators">Function decorators<a href="#function-decorators" class="hash-link" aria-label="Direct link to Function decorators" title="Direct link to Function decorators">â€‹</a></h3><p>FastKafka provides convenient function decorators <code>@kafka_app.consumes</code>
and <code>@kafka_app.produces</code> to allow you to delegate the actual process of</p><ul><li><p>consuming and producing data to Kafka, and</p></li><li><p>decoding and encoding JSON encode messages</p></li></ul><p>from user defined functions to the framework. The FastKafka framework
delegates these jobs to AIOKafka and Pydantic libraries.</p><p>These decorators make it easy to specify the processing logic for your
Kafka consumers and producers, allowing you to focus on the core
business logic of your application without worrying about the underlying
Kafka integration.</p><p>This following example shows how to use the <code>@kafka_app.consumes</code> and
<code>@kafka_app.produces</code> decorators in a FastKafka application:</p><ul><li><p>The <code>@kafka_app.consumes</code> decorator is applied to the <code>on_input_data</code>
function, which specifies that this function should be called whenever
a message is received on the â€œinput_data&quot; Kafka topic. The
<code>on_input_data</code> function takes a single argument which is expected to
be an instance of the <code>IrisInputData</code> message class. Specifying the
type of the single argument is instructing the Pydantic to use
<code>IrisInputData.parse_raw()</code> on the consumed message before passing it
to the user defined function <code>on_input_data</code>.</p></li><li><p>The <code>@produces</code> decorator is applied to the <code>to_predictions</code> function,
which specifies that this function should produce a message to the
â€œpredictions&quot; Kafka topic whenever it is called. The <code>to_predictions</code>
function takes a single integer argument <code>species_class</code> representing
one of three possible strign values predicted by the mdoel. It creates
a new <code>IrisPrediction</code> message using this value and then returns it.
The framework will call the <code>IrisPrediction.json().encode(&quot;utf-8&quot;)</code>
function on the returned value and produce it to the specified topic.</p></li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@kafka_app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;input_data&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> auto_offset_reset</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;latest&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_input_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IrisInputData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    species_class </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> ml_models</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;iris_predictor&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sepal_length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sepal_width</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">petal_length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">petal_width</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@kafka_app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;predictions&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> IrisPrediction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iris_species </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;setosa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;versicolor&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;virginica&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prediction </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> IrisPrediction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">iris_species</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> prediction</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-writing-the-test-code">4. Writing the test code<a href="#4-writing-the-test-code" class="hash-link" aria-label="Direct link to 4. Writing the test code" title="Direct link to 4. Writing the test code">â€‹</a></h2><p>The service can be tested using the <code>Tester</code> instance which can be
configured to start a <a href="/docs/0.7.0/api/fastkafka/testing/LocalRedpandaBroker/">Redpanda
broker</a> for testing
purposes. The <code>test.py</code> file in the cloned repository contains the
following code for testing.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> pytest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> application </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> IrisInputData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IrisPrediction</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kafka_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testing </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> Tester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msg </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> IrisInputData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_length</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_width</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_length</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_width</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@pytest</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">mark</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">asyncio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Start Tester app and create local Redpanda broker for testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">with</span><span class="token plain"> Tester</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kafka_app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">using_local_redpanda</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tag</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;v23.1.2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> listener_port</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">as</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Send IrisInputData message to input_data topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_input_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Assert that the kafka_app responded with IrisPrediction in predictions topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">awaited_mocks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_predictions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_awaited_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            IrisPrediction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;setosa&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>Tester</code> module utilizes uses <code>LocalRedpandaBroker</code> to start and
stop a Redpanda broker for testing purposes using Docker</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-running-the-tests">5. Running the tests<a href="#5-running-the-tests" class="hash-link" aria-label="Direct link to 5. Running the tests" title="Direct link to 5. Running the tests">â€‹</a></h2><p>We can run the tests which is in <code>test.py</code> file by executing the
following command:</p><div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest test.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will start a Redpanda broker using Docker and executes tests. The
output of the command is:</p><div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(venv) fastkafka@airt-ai:~/dev/sample_fastkafka_with_redpanda$ pytest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================== test session starts ===============================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">platform linux -- Python 3.10.6, pytest-7.2.2, pluggy-1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rootdir: /home/kumaran/dev/sample_fastkafka_with_redpanda, configfile: pytest.ini, testpaths: test.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins: asyncio-0.21.0, anyio-3.6.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asyncio: mode=strict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collected 1 item                                                                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test.py .                                                                  [100%]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=============================== 1 passed in 7.28s ================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(venv) fastkafka@airt-ai:~/dev/sample_fastkafka_with_redpanda$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Running the tests with the Redpanda broker ensures that your code is
working correctly with a real Kafka-like message broker, making your
tests more reliable.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recap">Recap<a href="#recap" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap">â€‹</a></h3><p>We have created an Iris classification model and encapulated it into our
<code>FastKafka</code> application. The app will consume the <code>IrisInputData</code> from
the <code>input_data</code> topic and produce the predictions to <code>predictions</code>
topic.</p><p>To test the app we have:</p><ol><li><p>Created the app</p></li><li><p>Started our <code>Tester</code> class with <code>Redpanda</code> broker which mirrors the
developed app topics for testing purposes</p></li><li><p>Sent <code>IrisInputData</code> message to <code>input_data</code> topic</p></li><li><p>Asserted and checked that the developed iris classification service
has reacted to <code>IrisInputData</code> message</p></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/0.7.0/guides/Guide_24_Using_Multiple_Kafka_Clusters/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using multiple Kafka clusters</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/0.7.0/guides/Guide_04_Github_Actions_Workflow/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploy FastKafka docs to GitHub Pages</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-fastkafka" class="table-of-contents__link toc-highlight">What is FastKafka?</a></li><li><a href="#what-is-redpanda" class="table-of-contents__link toc-highlight">What is Redpanda?</a></li><li><a href="#example-repo" class="table-of-contents__link toc-highlight">Example repo</a></li><li><a href="#the-process" class="table-of-contents__link toc-highlight">The process</a></li><li><a href="#1-prerequisites" class="table-of-contents__link toc-highlight">1. Prerequisites</a></li><li><a href="#2-cloning-and-setting-up-the-example-repo" class="table-of-contents__link toc-highlight">2. Cloning and setting up the example repo</a><ul><li><a href="#create-a-virtual-environment" class="table-of-contents__link toc-highlight">Create a virtual environment</a></li><li><a href="#install-python-dependencies" class="table-of-contents__link toc-highlight">Install Python dependencies</a></li></ul></li><li><a href="#3-writing-server-code" class="table-of-contents__link toc-highlight">3. Writing server code</a><ul><li><a href="#preparing-the-demo-model" class="table-of-contents__link toc-highlight">Preparing the demo model</a></li><li><a href="#messages" class="table-of-contents__link toc-highlight">Messages</a></li><li><a href="#application" class="table-of-contents__link toc-highlight">Application</a></li><li><a href="#function-decorators" class="table-of-contents__link toc-highlight">Function decorators</a></li></ul></li><li><a href="#4-writing-the-test-code" class="table-of-contents__link toc-highlight">4. Writing the test code</a></li><li><a href="#5-running-the-tests" class="table-of-contents__link toc-highlight">5. Running the tests</a><ul><li><a href="#recap" class="table-of-contents__link toc-highlight">Recap</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">COMMUNITY</div><ul class="footer__items clean-list"><li class="footer__item">
                      <a class="footer-discord-link" href="https://discord.gg/CJWmYpyFbc" target="_blank" rel="noreferrer noopener" aria-label="Discord link"></a>
                    </li><li class="footer__item">
                      <a class="footer-github-link" href="https://github.com/airtai" target="_blank" rel="noreferrer noopener" aria-label="Github link"></a>
                    </li><li class="footer__item">
                      <a class="footer-twitter-link" href="https://twitter.com/airt_AI" target="_blank" rel="noreferrer noopener" aria-label="Twitter link"></a>
                    </li><li class="footer__item">
                      <a class="footer-facebook-link" href="https://www.facebook.com/airt.ai.api/" target="_blank" rel="noreferrer noopener" aria-label="Facebook link"></a>
                    </li><li class="footer__item">
                      <a class="footer-linkedin-link" href="https://www.linkedin.com/company/airt-ai/" target="_blank" rel="noreferrer noopener" aria-label="LinkedIn link"></a>
                    </li></ul></div><div class="col footer__col"><div class="footer__title">EXPLORE DOCS</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">EXPLORE MORE</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://airt.ai/news" target="_blank" rel="noopener noreferrer" class="footer__link-item">News</a></li><li class="footer__item"><a href="https://airt.ai/about-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a></li><li class="footer__item"><a href="https://airt.ai/company-information" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company information</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2023 airt. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2d54bb54.js"></script>
<script src="/assets/js/main.23419ee6.js"></script>
</body>
</html>