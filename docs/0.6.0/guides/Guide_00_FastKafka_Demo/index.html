<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-0.6.0 plugin-docs plugin-id-default docs-doc-id-guides/Guide_00_FastKafka_Demo">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">FastKafka tutorial | FastKafka</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://opengraph.githubassets.com/1671805243.560327/airtai/fastkafka"><meta data-rh="true" name="twitter:image" content="https://opengraph.githubassets.com/1671805243.560327/airtai/fastkafka"><meta data-rh="true" property="og:url" content="https://fastkafka.airt.ai/docs/0.6.0/guides/Guide_00_FastKafka_Demo/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.6.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.6.0"><meta data-rh="true" name="docsearch:version" content="0.6.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.6.0"><meta data-rh="true" property="og:title" content="FastKafka tutorial | FastKafka"><meta data-rh="true" name="description" content="FastKafka is a powerful and easy-to-use"><meta data-rh="true" property="og:description" content="FastKafka is a powerful and easy-to-use"><link data-rh="true" rel="icon" href="/img/AIRT_icon_blue.svg"><link data-rh="true" rel="canonical" href="https://fastkafka.airt.ai/docs/0.6.0/guides/Guide_00_FastKafka_Demo/"><link data-rh="true" rel="alternate" href="https://fastkafka.airt.ai/docs/0.6.0/guides/Guide_00_FastKafka_Demo/" hreflang="en"><link data-rh="true" rel="alternate" href="https://fastkafka.airt.ai/docs/0.6.0/guides/Guide_00_FastKafka_Demo/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EHYNSIUGMY-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WLMWPELHMB"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WLMWPELHMB",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="FastKafka" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.4f0d6495.css">
<link rel="preload" href="/assets/js/runtime~main.2d54bb54.js" as="script">
<link rel="preload" href="/assets/js/main.23419ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://airt.ai" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/AIRT_icon_blue.svg" alt="airt logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/AIRT_icon_blue.svg" alt="airt logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">airt</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link fastkafka-home navbar__link--active" href="/"><div><img src="/img/home-icon.svg"><p>FastKafka</p></div></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/0.6.0/">0.6.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/guides/Guide_00_FastKafka_Demo/">dev ðŸš§</a></li><li><a class="dropdown__link" href="/docs/guides/Guide_00_FastKafka_Demo/">0.8.0</a></li><li><a class="dropdown__link" href="/docs/0.7.1/guides/Guide_00_FastKafka_Demo/">0.7.1</a></li><li><a class="dropdown__link" href="/docs/0.7.0/guides/Guide_00_FastKafka_Demo/">0.7.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.6.0/guides/Guide_00_FastKafka_Demo/">0.6.0</a></li><li><a class="dropdown__link" href="/docs/0.5.0/guides/Guide_00_FastKafka_Demo/">0.5.0</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/0.6.0/">Docs</a><div class="navbar__item github-stars"><iframe src="https://ghbtns.com/github-btn.html?user=airtai&repo=fastkafka&type=star&count=true&size=large" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe></div><a href="https://discord.gg/CJWmYpyFbc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Discord Link"></a><a aria-current="page" class="navbar__item navbar__link fastkafka-home-mobile navbar__link--active" href="/"><div><img src="/img/home-icon.svg"></div></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->FastKafka<!-- --> <b>0.6.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/guides/Guide_00_FastKafka_Demo/">latest version</a></b> (<!-- -->0.8.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 0.6.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>FastKafka tutorial</h1><p><a href="https://fastkafka.airt.ai/" target="_blank" rel="noopener noreferrer">FastKafka</a> is a powerful and easy-to-use
Python library for building asynchronous services that interact with
Kafka topics. Built on top of <a href="https://docs.pydantic.dev/" target="_blank" rel="noopener noreferrer">Pydantic</a>,
<a href="https://github.com/aio-libs/aiokafka" target="_blank" rel="noopener noreferrer">AIOKafka</a> and
<a href="https://www.asyncapi.com/" target="_blank" rel="noopener noreferrer">AsyncAPI</a>, FastKafka simplifies the process
of writing producers and consumers for Kafka topics, handling all the
parsing, networking, task scheduling and data generation automatically.
With FastKafka, you can quickly prototype and develop high-performance
Kafka-based services with minimal code, making it an ideal choice for
developers looking to streamline their workflow and accelerate their
projects.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install">Install<a href="#install" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install">â€‹</a></h2><p>FastKafka works on macOS, Linux, and most Unix-style operating systems.
You can install it with <code>pip</code> as usual:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install fastkafka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> fastkafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">except</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ! pip install fastkafka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-in-colab">Running in Colab<a href="#running-in-colab" class="hash-link" aria-label="Direct link to Running in Colab" title="Direct link to Running in Colab">â€‹</a></h2><p>You can start this interactive tutorial in Google Colab by clicking the
button below:</p><a href="https://colab.research.google.com/github/airtai/fastkafka/blob/main/nbs/guides/Guide_00_FastKafka_Demo.ipynb" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" class="img_ev3q"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="writing-server-code">Writing server code<a href="#writing-server-code" class="hash-link" aria-label="Direct link to Writing server code" title="Direct link to Writing server code">â€‹</a></h2><p>Here is an example python script using FastKafka that takes data from a
Kafka topic, makes a prediction using a predictive model, and outputs
the prediction to another Kafka topic.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparing-the-demo-model">Preparing the demo model<a href="#preparing-the-demo-model" class="hash-link" aria-label="Direct link to Preparing the demo model" title="Direct link to Preparing the demo model">â€‹</a></h3><p>First we will prepare our model using the Iris dataset so that we can
demonstrate the preditions using FastKafka. The following call downloads
the dataset and trains the model.</p><p>We will wrap the model creation into a lifespan of our app so that the
model is created just before the app is started.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> contextlib </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> asynccontextmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> load_iris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linear_model </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> LogisticRegression</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ml_models </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@asynccontextmanager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">lifespan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Load the ML model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">return_X_y</span><span class="token operator" style="color:#D73A49">=</span><span class="token boolean" style="color:#005CC5">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ml_models</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;iris_predictor&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> LogisticRegression</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">random_state</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_iter</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">yield</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Clean up the ML models and release the resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ml_models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="messages">Messages<a href="#messages" class="hash-link" aria-label="Direct link to Messages" title="Direct link to Messages">â€‹</a></h3><p>FastKafka uses <a href="https://docs.pydantic.dev/" target="_blank" rel="noopener noreferrer">Pydantic</a> to parse input
JSON-encoded data into Python objects, making it easy to work with
structured data in your Kafka-based applications. Pydanticâ€™s
<a href="https://docs.pydantic.dev/usage/models/" target="_blank" rel="noopener noreferrer"><code>BaseModel</code></a> class allows you
to define messages using a declarative syntax, making it easy to specify
the fields and types of your messages.</p><p>This example defines two message classes for use in a FastKafka
application:</p><ul><li><p>The <code>IrisInputData</code> class is used to represent input data for a
predictive model. It has four fields of type
<a href="https://docs.pydantic.dev/usage/types/#constrained-types" target="_blank" rel="noopener noreferrer"><code>NonNegativeFloat</code></a>,
which is a subclass of float that only allows non-negative floating
point values.</p></li><li><p>The <code>IrisPrediction</code> class is used to represent the output of the
predictive model. It has a single field <code>species</code> of type string
representing the predicted species.</p></li></ul><p>These message classes will be used to parse and validate incoming data
in Kafka consumers and producers.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NonNegativeFloat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">IrisInputData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Sepal length in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Sepal width in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Petal length in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Petal width in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">IrisPrediction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    species</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">str</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;setosa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Predicted species&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application">Application<a href="#application" class="hash-link" aria-label="Direct link to Application" title="Direct link to Application">â€‹</a></h3><p>This example shows how to initialize a FastKafka application.</p><p>It starts by defining a dictionary called <code>kafka_brokers</code>, which
contains two entries: <code>&quot;localhost&quot;</code> and <code>&quot;production&quot;</code>, specifying local
development and production Kafka brokers. Each entry specifies the URL,
port, and other details of a Kafka broker. This dictionary is used for
generating the documentation only and it is not being checked by the
actual server.</p><p>Next, an object of the
<a href="/docs/0.6.0/api/fastkafka//#fastkafka.FastKafka"><code>FastKafka</code></a>
class is initialized with the minimum set of arguments:</p><ul><li><code>kafka_brokers</code>: a dictionary used for generation of documentation</li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#C6105F">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;local development kafka broker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;port&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#C6105F">&quot;production&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kafka.airt.ai&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;production kafka broker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;port&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;protocol&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kafka-secure&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;security&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#C6105F">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;plain&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_app </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Iris predictions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kafka_brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lifespan</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">lifespan</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="function-decorators">Function decorators<a href="#function-decorators" class="hash-link" aria-label="Direct link to Function decorators" title="Direct link to Function decorators">â€‹</a></h3><p>FastKafka provides convenient function decorators <code>@kafka_app.consumes</code>
and <code>@kafka_app.produces</code> to allow you to delegate the actual process of</p><ul><li><p>consuming and producing data to Kafka, and</p></li><li><p>decoding and encoding JSON encode messages</p></li></ul><p>from user defined functions to the framework. The FastKafka framework
delegates these jobs to AIOKafka and Pydantic libraries.</p><p>These decorators make it easy to specify the processing logic for your
Kafka consumers and producers, allowing you to focus on the core
business logic of your application without worrying about the underlying
Kafka integration.</p><p>This following example shows how to use the <code>@kafka_app.consumes</code> and
<code>@kafka_app.produces</code> decorators in a FastKafka application:</p><ul><li><p>The <code>@kafka_app.consumes</code> decorator is applied to the <code>on_input_data</code>
function, which specifies that this function should be called whenever
a message is received on the â€œinput_data&quot; Kafka topic. The
<code>on_input_data</code> function takes a single argument which is expected to
be an instance of the <code>IrisInputData</code> message class. Specifying the
type of the single argument is instructing the Pydantic to use
<code>IrisInputData.parse_raw()</code> on the consumed message before passing it
to the user defined function <code>on_input_data</code>.</p></li><li><p>The <code>@produces</code> decorator is applied to the <code>to_predictions</code> function,
which specifies that this function should produce a message to the
â€œpredictions&quot; Kafka topic whenever it is called. The <code>to_predictions</code>
function takes a single integer argument <code>species_class</code> representing
one of three possible strign values predicted by the mdoel. It creates
a new <code>IrisPrediction</code> message using this value and then returns it.
The framework will call the <code>IrisPrediction.json().encode(&quot;utf-8&quot;)</code>
function on the returned value and produce it to the specified topic.</p></li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@kafka_app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;input_data&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> auto_offset_reset</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;latest&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_input_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IrisInputData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    species_class </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> ml_models</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;iris_predictor&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sepal_length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sepal_width</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">petal_length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">petal_width</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@kafka_app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;predictions&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> IrisPrediction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iris_species </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;setosa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;versicolor&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;virginica&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prediction </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> IrisPrediction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">iris_species</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> prediction</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-service">Testing the service<a href="#testing-the-service" class="hash-link" aria-label="Direct link to Testing the service" title="Direct link to Testing the service">â€‹</a></h2><p>The service can be tested using the
<a href="/docs/0.6.0/api/fastkafka/testing/Tester/#fastkafka.testing.Tester"><code>Tester</code></a>
instances which internally starts Kafka broker and zookeeper.</p><p>Before running tests, we have to install Java runtime and Apache Kafka
locally. To simplify the process, we provide the following convenience
command:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fastkafka testing install_deps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: Java is already installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: But not exported to PATH, exporting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: Kafka is installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: But not exported to PATH, exporting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: Java is already installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: But not exported to PATH, exporting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: Kafka is installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: But not exported to PATH, exporting...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">testing </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> Tester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msg </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> IrisInputData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_length</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_width</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_length</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_width</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Start Tester app and create local Kafka broker for testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">with</span><span class="token plain"> Tester</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kafka_app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">as</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Send IrisInputData message to input_data topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_input_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Assert that the kafka_app responded with IrisPrediction in predictions topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">await</span><span class="token plain"> tester</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">awaited_mocks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_predictions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">assert_awaited_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IrisPrediction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;setosa&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._start() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._patch_consumers_and_producers(): Patching consumers and producers!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: InMemoryBroker starting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;localhost:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;localhost:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;bootstrap_servers&#x27;: &#x27;localhost:9092&#x27;, &#x27;auto_offset_reset&#x27;: &#x27;latest&#x27;, &#x27;max_poll_records&#x27;: 100}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;input_data&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;bootstrap_servers&#x27;: &#x27;localhost:9092&#x27;, &#x27;auto_offset_reset&#x27;: &#x27;earliest&#x27;, &#x27;max_poll_records&#x27;: 100}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched start() called()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched subscribe() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer.subscribe(), subscribing to: [&#x27;predictions&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: _aiokafka_consumer_loop(): Consumer loop shutting down, waiting for send_stream to drain...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: _aiokafka_consumer_loop(): Consumer loop shutting down, waiting for send_stream to drain...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaConsumer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: AIOKafkaProducer patched stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: InMemoryBroker._stop() called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.in_memory_broker: InMemoryBroker stopping</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recap">Recap<a href="#recap" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap">â€‹</a></h3><p>We have created a Iris classification model and encapulated it into our
fastkafka application. The app will consume the IrisInputData from the
<code>input_data</code> topic and produce the predictions to <code>predictions</code> topic.</p><p>To test the app we have:</p><ol><li><p>Created the app</p></li><li><p>Started our Tester class which mirrors the developed app topics for
testing purpuoses</p></li><li><p>Sent IrisInputData message to <code>input_data</code> topic</p></li><li><p>Asserted and checked that the developed iris classification service
has reacted to IrisInputData message</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-service">Running the service<a href="#running-the-service" class="hash-link" aria-label="Direct link to Running the service" title="Direct link to Running the service">â€‹</a></h2><p>The service can be started using builtin <code>faskafka run</code> CLI command.
Before we can do that, we will concatenate the code snippets from above
and save them in a file <code>&quot;application.py&quot;</code></p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#6B6B6B;font-style:italic"># content of the &quot;application.py&quot; file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> contextlib </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> asynccontextmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> load_iris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linear_model </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> LogisticRegression</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ml_models </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@asynccontextmanager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">lifespan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Load the ML model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">return_X_y</span><span class="token operator" style="color:#D73A49">=</span><span class="token boolean" style="color:#005CC5">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ml_models</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;iris_predictor&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> LogisticRegression</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">random_state</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_iter</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">yield</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#6B6B6B;font-style:italic"># Clean up the ML models and release the resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ml_models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NonNegativeFloat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">IrisInputData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Sepal length in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sepal_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Sepal width in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Petal length in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    petal_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NonNegativeFloat </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Petal width in cm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">class</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">IrisPrediction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    species</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">str</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> Field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;setosa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Predicted species&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#C6105F">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;local development kafka broker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;port&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#C6105F">&quot;production&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kafka.airt.ai&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;production kafka broker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;port&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;protocol&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kafka-secure&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;security&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#C6105F">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;plain&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_app </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Iris predictions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kafka_brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lifespan</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">lifespan</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@kafka_app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">consumes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;input_data&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> auto_offset_reset</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;latest&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">on_input_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IrisInputData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    species_class </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> ml_models</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;iris_predictor&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sepal_length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sepal_width</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">petal_length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">petal_width</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@kafka_app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">produces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;predictions&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">def</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">to_predictions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin" style="color:#005CC5">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token plain"> IrisPrediction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iris_species </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#C6105F">&quot;setosa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;versicolor&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;virginica&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prediction </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> IrisPrediction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">species</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">iris_species</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">species_class</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#CF222E">return</span><span class="token plain"> prediction</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To run the service, you will need a running Kafka broker on localhost as
specified in the <code>kafka_brokers</code> parameter above. We can start the Kafka
broker locally using the
<a href="/docs/0.6.0/api/fastkafka/testing/ApacheKafkaBroker/#fastkafka.testing.ApacheKafkaBroker"><code>ApacheKafkaBroker</code></a>.
Notice that the same happens automatically in the
<a href="/docs/0.6.0/api/fastkafka/testing/Tester/#fastkafka.testing.Tester"><code>Tester</code></a>
as shown above.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.apache_kafka_broker: ApacheKafkaBroker.start(): entering...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARNING] fastkafka._testing.apache_kafka_broker: ApacheKafkaBroker.start(): (&lt;_UnixSelectorEventLoop running=True closed=False debug=False&gt;) is already running!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARNING] fastkafka._testing.apache_kafka_broker: ApacheKafkaBroker.start(): calling nest_asyncio.apply()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: Java is already installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: But not exported to PATH, exporting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: Kafka is installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.test_dependencies: But not exported to PATH, exporting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.apache_kafka_broker: Starting zookeeper...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.apache_kafka_broker: Starting kafka...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.apache_kafka_broker: Local Kafka broker up and running on 127.0.0.1:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.apache_kafka_broker: &lt;class &#x27;fastkafka.testing.ApacheKafkaBroker&#x27;&gt;.start(): returning 127.0.0.1:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.apache_kafka_broker: ApacheKafkaBroker.start(): exited.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;127.0.0.1:9092&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, we start the FastKafka service by running the following command in
the folder where the <code>application.py</code> file is located:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fastkafka run --num-workers=2 --kafka-broker localhost application:kafka_app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above command, we use <code>--num-workers</code> option to specify how many
workers to launch and we use <code>--kafka-broker</code> option to specify which
kafka broker configuration to use from earlier specified <code>kafka_brokers</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._application.app: set_kafka_broker() : Setting bootstrap_servers value to &#x27;localhost:9092&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;localhost:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;bootstrap_servers&#x27;: &#x27;localhost:9092&#x27;, &#x27;auto_offset_reset&#x27;: &#x27;latest&#x27;, &#x27;max_poll_records&#x27;: 100}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] aiokafka.consumer.subscription_state: Updating subscribed topics to: frozenset({&#x27;input_data&#x27;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] aiokafka.consumer.consumer: Subscribed to topic(s): {&#x27;input_data&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._application.app: set_kafka_broker() : Setting bootstrap_servers value to &#x27;localhost:9092&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._application.app: _create_producer() : created producer using the config: &#x27;{&#x27;bootstrap_servers&#x27;: &#x27;localhost:9092&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [WARNING] aiokafka.cluster: Topic input_data is not available during auto-create initialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] aiokafka.consumer.group_coordinator: Metadata for topic has changed from {} to {&#x27;input_data&#x27;: 0}. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer created using the following parameters: {&#x27;bootstrap_servers&#x27;: &#x27;localhost:9092&#x27;, &#x27;auto_offset_reset&#x27;: &#x27;latest&#x27;, &#x27;max_poll_records&#x27;: 100}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] aiokafka.consumer.subscription_state: Updating subscribed topics to: frozenset({&#x27;input_data&#x27;})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] aiokafka.consumer.consumer: Subscribed to topic(s): {&#x27;input_data&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer subscribed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [WARNING] aiokafka.cluster: Topic input_data is not available during auto-create initialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] aiokafka.consumer.group_coordinator: Metadata for topic has changed from {} to {&#x27;input_data&#x27;: 0}. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [ERROR] aiokafka: Unable connect to node with id 0: [Errno 111] Connect call failed (&#x27;192.168.112.2&#x27;, 9092)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [ERROR] aiokafka: Unable to update metadata from [0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [ERROR] aiokafka: Unable connect to node with id 0: [Errno 111] Connect call failed (&#x27;192.168.112.2&#x27;, 9092)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [ERROR] aiokafka: Unable to update metadata from [0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._components.aiokafka_consumer_loop: _aiokafka_consumer_loop(): Consumer loop shutting down, waiting for send_stream to drain...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200656]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._components.aiokafka_consumer_loop: _aiokafka_consumer_loop(): Consumer loop shutting down, waiting for send_stream to drain...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop(): Consumer stopped.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1200654]: [INFO] fastkafka._components.aiokafka_consumer_loop: aiokafka_consumer_loop() finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting process cleanup, this may take a few seconds...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._server: terminate_asyncio_process(): Terminating the process 1200654...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._server: terminate_asyncio_process(): Terminating the process 1200656...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You need to interupt running of the cell above by selecting
<code>Runtime-&gt;Interupt execution</code> on the toolbar above.</p><p>Finally, we can stop the local Kafka Broker:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.apache_kafka_broker: ApacheKafkaBroker.stop(): entering...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components._subprocess: terminate_asyncio_process(): Terminating the process 1200193...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components._subprocess: terminate_asyncio_process(): Process 1200193 was already terminated.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components._subprocess: terminate_asyncio_process(): Terminating the process 1199820...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components._subprocess: terminate_asyncio_process(): Process 1199820 was already terminated.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._testing.apache_kafka_broker: ApacheKafkaBroker.stop(): exited.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="documentation">Documentation<a href="#documentation" class="hash-link" aria-label="Direct link to Documentation" title="Direct link to Documentation">â€‹</a></h2><p>The kafka app comes with builtin documentation generation using
<a href="https://www.asyncapi.com/tools/generator" target="_blank" rel="noopener noreferrer">AsyncApi HTML generator</a>.</p><p>When running in Colab, we need to update Node.js first:</p><p>We need to install all dependancies for the generator using the
following command line:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fastkafka docs install_deps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.docs_dependencies: AsyncAPI generator installed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To generate the documentation programatically you just need to call the
folloving command:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fastkafka docs generate application:kafka_app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.asyncapi: New async specifications generated at: &#x27;/work/fastkafka/nbs/guides/asyncapi/spec/asyncapi.yml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.asyncapi: Async docs generated at &#x27;asyncapi/docs&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.asyncapi: Output of &#x27;$ npx -y -p @asyncapi/generator ag asyncapi/spec/asyncapi.yml @asyncapi/html-template -o asyncapi/docs --force-write&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done! âœ¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Check out your shiny new generated files at /work/fastkafka/nbs/guides/asyncapi/docs.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>. This will generate the <em>asyncapi</em> folder in relative path where all
your documentation will be saved. You can check out the content of it
with:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ls -l asyncapi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">total 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwxr-x 4 kumaran kumaran 4096 Mar 21 10:09 docs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwxr-x 2 kumaran kumaran 4096 Mar 21 10:09 spec</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In docs folder you will find the servable static html file of your
documentation. This can also be served using our <code>fastkafka docs serve</code>
CLI command (more on that in our guides).</p><p>In spec folder you will find a asyncapi.yml file containing the async
API specification of your application.</p><p>We can locally preview the generated documentation by running the
following command:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fastkafka docs serve application:kafka_app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.asyncapi: New async specifications generated at: &#x27;/work/fastkafka/nbs/guides/asyncapi/spec/asyncapi.yml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.asyncapi: Async docs generated at &#x27;asyncapi/docs&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] fastkafka._components.asyncapi: Output of &#x27;$ npx -y -p @asyncapi/generator ag asyncapi/spec/asyncapi.yml @asyncapi/html-template -o asyncapi/docs --force-write&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done! âœ¨</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Check out your shiny new generated files at /work/fastkafka/nbs/guides/asyncapi/docs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Serving documentation on http://127.0.0.1:8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Interupting serving of documentation and cleaning up...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From the parameters passed to the application constructor, we get the
documentation bellow:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">from</span><span class="token plain"> fastkafka </span><span class="token keyword" style="color:#CF222E">import</span><span class="token plain"> FastKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_brokers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#C6105F">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;local development kafka broker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;port&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#C6105F">&quot;production&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kafka.airt.ai&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;description&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;production kafka broker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;port&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">9092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;protocol&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kafka-secure&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#C6105F">&quot;security&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#C6105F">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;plain&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_app </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> FastKafka</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;Iris predictions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kafka_brokers</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">kafka_brokers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bootstrap_servers</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;localhost:9092&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://raw.githubusercontent.com/airtai/fastkafka/main/nbs/images/screenshot-kafka-servers.png" alt="Kafka_servers" class="img_ev3q"></p><p>The following documentation snippet are for the consumer as specified in
the code above:</p><p><img loading="lazy" src="https://raw.githubusercontent.com/airtai/fastkafka/main/nbs/images/screenshot-kafka-consumer.png" alt="Kafka_consumer" class="img_ev3q"></p><p>The following documentation snippet are for the producer as specified in
the code above:</p><p><img loading="lazy" src="https://raw.githubusercontent.com/airtai/fastkafka/main/nbs/images/screenshot-kafka-producer.png" alt="Kafka_producer" class="img_ev3q"></p><p>Finally, all messages as defined as subclasses of <em>BaseModel</em> are
documented as well:</p><p><img loading="lazy" src="https://raw.githubusercontent.com/airtai/fastkafka/main/nbs/images/screenshot-kafka-messages.png" alt="Kafka_![Kafka_servers](https://raw.githubusercontent.com/airtai/fastkafka/main/nbs/images/screenshot-kafka-messages.png)" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#install" class="table-of-contents__link toc-highlight">Install</a></li><li><a href="#running-in-colab" class="table-of-contents__link toc-highlight">Running in Colab</a></li><li><a href="#writing-server-code" class="table-of-contents__link toc-highlight">Writing server code</a><ul><li><a href="#preparing-the-demo-model" class="table-of-contents__link toc-highlight">Preparing the demo model</a></li><li><a href="#messages" class="table-of-contents__link toc-highlight">Messages</a></li><li><a href="#application" class="table-of-contents__link toc-highlight">Application</a></li><li><a href="#function-decorators" class="table-of-contents__link toc-highlight">Function decorators</a></li></ul></li><li><a href="#testing-the-service" class="table-of-contents__link toc-highlight">Testing the service</a><ul><li><a href="#recap" class="table-of-contents__link toc-highlight">Recap</a></li></ul></li><li><a href="#running-the-service" class="table-of-contents__link toc-highlight">Running the service</a></li><li><a href="#documentation" class="table-of-contents__link toc-highlight">Documentation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">COMMUNITY</div><ul class="footer__items clean-list"><li class="footer__item">
                      <a class="footer-discord-link" href="https://discord.gg/CJWmYpyFbc" target="_blank" rel="noreferrer noopener" aria-label="Discord link"></a>
                    </li><li class="footer__item">
                      <a class="footer-github-link" href="https://github.com/airtai" target="_blank" rel="noreferrer noopener" aria-label="Github link"></a>
                    </li><li class="footer__item">
                      <a class="footer-twitter-link" href="https://twitter.com/airt_AI" target="_blank" rel="noreferrer noopener" aria-label="Twitter link"></a>
                    </li><li class="footer__item">
                      <a class="footer-facebook-link" href="https://www.facebook.com/airt.ai.api/" target="_blank" rel="noreferrer noopener" aria-label="Facebook link"></a>
                    </li><li class="footer__item">
                      <a class="footer-linkedin-link" href="https://www.linkedin.com/company/airt-ai/" target="_blank" rel="noreferrer noopener" aria-label="LinkedIn link"></a>
                    </li></ul></div><div class="col footer__col"><div class="footer__title">EXPLORE DOCS</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Get Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">EXPLORE MORE</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://airt.ai/news" target="_blank" rel="noopener noreferrer" class="footer__link-item">News</a></li><li class="footer__item"><a href="https://airt.ai/about-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a></li><li class="footer__item"><a href="https://airt.ai/company-information" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company information</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2023 airt. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2d54bb54.js"></script>
<script src="/assets/js/main.23419ee6.js"></script>
</body>
</html>