
<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
import tempfile

import pytest
from pydantic import Field

from fastkafka._components.logger import supress_timestamps
```

``` python
supress_timestamps()
logger = get_logger(__name__, level=20)
logger.info("ok")
```

    [INFO] __main__: ok

------------------------------------------------------------------------

### AvroBase

>      AvroBase ()

This is base pydantic class that will add some methods

``` python
test_user_schema = {
    "type": "record",
    "namespace": "User",
    "name": "User",
    "fields": [
        {"type": "string", "name": "name"},
        {"type": ["null", "long"], "name": "favorite_number", "default": None},
        {"type": ["null", "string"], "name": "favorite_color", "default": None},
    ],
}


class User(BaseModel):
    name: str
    favorite_number: Optional[int] = None
    favorite_color: Optional[str] = None
```

``` python
actual = AvroBase.avro_schema_for_pydantic(User)
display(actual)
assert actual == test_user_schema
```

    {'type': 'record',
     'namespace': 'User',
     'name': 'User',
     'fields': [{'type': 'string', 'name': 'name'},
      {'type': ['null', 'long'], 'name': 'favorite_number', 'default': None},
      {'type': ['null', 'string'], 'name': 'favorite_color', 'default': None}]}

``` python
# ToDo
# 1. Rewrite with fastavro - Done
# 2. Generate schema from pydantic itself - Done
#        - Pydantic to avro schema conversion methods - Done
# 3. Generate pydantic class from avro schema
```

------------------------------------------------------------------------

### avro_encoder

>      avro_encoder (msg:pydantic.main.BaseModel)

Encoder to encode pydantic instances to avro message

Args: msg: An instance of pydantic basemodel

Returns: A bytes message which is encoded from pydantic basemodel

``` python
msg = User(name="Kumaran", favorite_number=9, favorite_color="black")


actual = avro_encoder(msg)
display(actual)

assert isinstance(actual, bytes)
assert actual == b"\x0eKumaran\x02\x12\x02\nblack"
```

    b'\x0eKumaran\x02\x12\x02\nblack'

------------------------------------------------------------------------

### avro_decoder

>      avro_decoder (raw_msg:bytes, cls:pydantic.main.ModelMetaclass)

Decoder to decode avro encoded messages to pydantic model instance

Args: raw_msg: Avro encoded bytes message received from Kafka topic cls:
Pydantic class; This pydantic class will be used to construct instance
of same class

Returns: An instance of given pydantic class

``` python
raw_msg = b"\x06123\x02\x00\x02\x06111"


actual = avro_decoder(raw_msg, cls=User)
display(actual)

assert isinstance(actual, User)
assert actual.name == "123"
assert actual.favorite_number == 0
assert actual.favorite_color == "111"
```

    User(name='123', favorite_number=0, favorite_color='111')

------------------------------------------------------------------------

### avsc_to_pydantic

>      avsc_to_pydantic (schema:Dict[str,Any])

Generate pydantic model from given Avro Schema

Args: schema: Avro schema in dictionary format

Returns: Pydantic model class built from given avro schema

``` python
user_schema = AvroBase.avro_schema_for_pydantic(User)
display(user_schema)

A = avsc_to_pydantic(user_schema)
display(A)
display(A.__fields__)
assert isinstance(A, ModelMetaclass)
assert list(A.__fields__.keys()) == ["name", "favorite_number", "favorite_color"]

assert A(name="Kumaran", favorite_number="9", favorite_color="black") == User(
    name="Kumaran", favorite_number="9", favorite_color="black"
)
```

    {'type': 'record',
     'namespace': 'User',
     'name': 'User',
     'fields': [{'type': 'string', 'name': 'name'},
      {'type': ['null', 'long'], 'name': 'favorite_number', 'default': None},
      {'type': ['null', 'string'], 'name': 'favorite_color', 'default': None}]}

    pydantic.main.User

    {'name': ModelField(name='name', type=str, required=True),
     'favorite_number': ModelField(name='favorite_number', type=Optional[int], required=False, default=None),
     'favorite_color': ModelField(name='favorite_color', type=Optional[str], required=False, default=None)}

``` python
user_schema = AvroBase.avro_schema_for_pydantic(User)
user_schema["fields"] = []

display(user_schema)

with pytest.raises(ValueError) as e:
    A = avsc_to_pydantic(user_schema)
display(e)
```

    {'type': 'record', 'namespace': 'User', 'name': 'User', 'fields': []}

    <ExceptionInfo ValueError('Avro schema has no fields') tblen=3>
