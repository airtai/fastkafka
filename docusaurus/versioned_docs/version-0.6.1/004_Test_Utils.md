
<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
import time
from inspect import signature

import anyio
import nest_asyncio
import pytest
from nbdev_mkdocs.docstring import run_examples_from_docstring
from tqdm.notebook import tqdm, trange

from fastkafka._components.logger import supress_timestamps
from fastkafka._helpers import consumes_messages, produce_messages
from fastkafka._testing.apache_kafka_broker import ApacheKafkaBroker
```

``` python
# allows async calls in notebooks

nest_asyncio.apply()
```

``` python
supress_timestamps()
logger = get_logger(__name__, level=20)
logger.info("ok")
```

    [INFO] __main__: ok

------------------------------------------------------------------------

<a
href="https://github.com/airtai/fastkafka/blob/main/fastkafka/_testing/test_utils.py#L32"
target="_blank" style={{float: 'right', fontSize: 'smaller'}}>source</a>

### nb_safe_seed

>      nb_safe_seed (s:str)

Gets a unique seed function for a notebook

Params: s: name of the notebook used to initialize the seed function

Returns: A unique seed function

``` python
seed = nb_safe_seed("999_test_utils")

assert seed() == seed(0)
assert seed() + 1 == seed(1)
```

------------------------------------------------------------------------

<a
href="https://github.com/airtai/fastkafka/blob/main/fastkafka/_testing/test_utils.py#L50"
target="_blank" style={{float: 'right', fontSize: 'smaller'}}>source</a>

### mock_AIOKafkaProducer_send

>      mock_AIOKafkaProducer_send ()

Mocks **send** method of **AIOKafkaProducer**

------------------------------------------------------------------------

<a
href="https://github.com/airtai/fastkafka/blob/main/fastkafka/_testing/test_utils.py#L62"
target="_blank" style={{float: 'right', fontSize: 'smaller'}}>source</a>

### run_script_and_cancel

>      run_script_and_cancel (script:str, script_file:Optional[str]=None,
>                             cmd:Optional[str]=None, cancel_after:int=10,
>                             app_name:str='app',
>                             kafka_app_name:str='kafka_app',
>                             generate_docs:bool=False)

Run script and cancel after predefined time

Args: script: a python source code to be executed in a separate
subprocess script_file: name of the script where script source will be
saved cmd: command to execute. If None, it will be set to ‘python3 -m
{Path(script_file).stem}’ cancel_after: number of seconds before sending
SIGTERM signal

Returns: A tuple containing exit code and combined stdout and stderr as
a binary string

``` python
# Check exit code 0
script = """
from time import sleep
print("hello")
sleep({t})
"""

exit_code, output = await run_script_and_cancel(script.format(t=0), cancel_after=2)
assert exit_code == 0, exit_code
assert output.decode("utf-8") == "hello\n", output.decode("utf-8")

exit_code, output = await run_script_and_cancel(script.format(t=5), cancel_after=2)
assert exit_code < 0, exit_code
```

``` python
# Check exit code 1
script = "exit(1)"

exit_code, output = await run_script_and_cancel(script, cancel_after=1)

assert exit_code == 1
assert output.decode("utf-8") == ""
```

``` python
# Check exit code 0 and output to stdout and stderr
script = """
import sys
sys.stderr.write("hello from stderr\\n")
sys.stderr.flush()
print("hello, exiting with exit code 0")
exit(0)
"""

exit_code, output = await run_script_and_cancel(script, cancel_after=1)

assert exit_code == 0, exit_code
assert (
    output.decode("utf-8") == "hello from stderr\nhello, exiting with exit code 0\n"
), output.decode("utf-8")
```

``` python
# Check random exit code and output
script = """
print("hello\\nexiting with exit code 143")
exit(143)
"""

exit_code, output = await run_script_and_cancel(script, cancel_after=1)

assert exit_code == 143
assert output.decode("utf-8") == "hello\nexiting with exit code 143\n"

print("ok")
```

    ok

------------------------------------------------------------------------

<a
href="https://github.com/airtai/fastkafka/blob/main/fastkafka/_testing/test_utils.py#L119"
target="_blank" style={{float: 'right', fontSize: 'smaller'}}>source</a>

### display_docs

>      display_docs (docs_path:str, port:int=4000)

``` python
example_html = """


    
        Example
    
    
        This is an example of a simple HTML page with one paragraph.
    

"""

with TemporaryDirectory() as tmp:
    with change_dir(tmp):
        with open(Path(tmp) / "index.html", "w") as index_file:
            index_file.write(example_html)
        await display_docs(docs_path=tmp, port=4000)
```

        <iframe
            width="1000"
            height="700"
            src="http://localhost:4000"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        

    [INFO] fastkafka._components._subprocess: terminate_asyncio_process(): Terminating the process 2028...
    [INFO] fastkafka._components._subprocess: terminate_asyncio_process(): Process 2028 terminated.
