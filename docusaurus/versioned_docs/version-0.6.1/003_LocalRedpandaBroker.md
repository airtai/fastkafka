
<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
from aiokafka import AIOKafkaConsumer, AIOKafkaProducer

from fastkafka._components.logger import supress_timestamps
```

``` python
supress_timestamps()
logger = get_logger(__name__, level=20)
logger.info("ok")
```

    [INFO] __main__: ok

------------------------------------------------------------------------

<a
href="https://github.com/airtai/fastkafka/blob/main/fastkafka/_testing/local_redpanda_broker.py#L31"
target="_blank" style={{float: 'right', fontSize: 'smaller'}}>source</a>

### get_redpanda_docker_cmd

>      get_redpanda_docker_cmd (listener_port:int=9092, tag:str='v23.1.2',
>                               seastar_core:int=1, memory:str='1G',
>                               mode:str='dev-container',
>                               default_log_level:str='debug')

Generates a Docker CLI command to start redpanda container

Args: listener_port: Port on which the clients (producers and consumers)
can connect tag: Tag of Redpanda image to use to start container
seastar_core: Core(s) to use byt Seastar (the framework Redpanda uses
under the hood) memory: The amount of memory to make available to
Redpanda mode: Mode to use to load configuration properties in container
default_log_level: Log levels to use for Redpanda

``` python
expected = "docker run --rm --name redpanda_9093 -p 9093:9093 docker.redpanda.com/redpandadata/redpanda:latest redpanda start --kafka-addr internal://0.0.0.0:9090,external://0.0.0.0:9093 --advertise-kafka-addr internal://localhost:9090,external://localhost:9093 --smp 1 --memory 2G --mode dev-container --default-log-level debug"
actual = get_redpanda_docker_cmd(listener_port=9093, tag="latest", memory="2G")
assert " ".join(actual) == expected, actual
```

------------------------------------------------------------------------

### LocalRedpandaBroker

>      LocalRedpandaBroker (topics:Iterable[str]=[], retries:int=3,
>                           apply_nest_asyncio:bool=False,
>                           listener_port:int=9092, tag:str='v23.1.2',
>                           seastar_core:int=1, memory:str='1G', mode:str='dev-
>                           container', default_log_level:str='debug',
>                           **kwargs:Dict[str,Any])

LocalRedpandaBroker class, used for running unique redpanda brokers in
tests to prevent topic clashing.

``` python
broker = LocalRedpandaBroker()
broker
```

    <fastkafka.testing.LocalRedpandaBroker>

------------------------------------------------------------------------

<a
href="https://github.com/airtai/fastkafka/blob/main/fastkafka/_testing/local_redpanda_broker.py#L192"
target="_blank" style={{float: 'right', fontSize: 'smaller'}}>source</a>

### check_docker

>      check_docker ()

``` python
await check_docker()
```

    False

``` python
broker = LocalRedpandaBroker()

# Run test case only if docker is installed
if await check_docker():
    await broker._check_deps()
```

``` python
# docker run --rm --name redpanda_9092 -p 9092:9092 docker.redpanda.com/redpandadata/redpanda 'redpanda start --kafka-addr internal://0.0.0.0:9090,external://0.0.0.0:9092 --advertise-kafka-addr internal://localhost:9090,external://localhost:9092'
```

``` python
broker = LocalRedpandaBroker()

# Run test case only if docker is installed
if await check_docker():
    async with broker:
        pass

    print("*" * 50 + "REDPANDA LOGS" + "+" * 50)
    redpanda_output, _ = await broker.redpanda_task.communicate()
    print(redpanda_output.decode("UTF-8"))
```

------------------------------------------------------------------------

<a
href="https://github.com/airtai/fastkafka/blob/main/fastkafka/_testing/local_redpanda_broker.py#L351"
target="_blank" style={{float: 'right', fontSize: 'smaller'}}>source</a>

### LocalRedpandaBroker.stop

>      LocalRedpandaBroker.stop ()

Stops a local redpanda broker instance synchronously Returns: None

------------------------------------------------------------------------

<a
href="https://github.com/airtai/fastkafka/blob/main/fastkafka/_testing/local_redpanda_broker.py#L308"
target="_blank" style={{float: 'right', fontSize: 'smaller'}}>source</a>

### LocalRedpandaBroker.start

>      LocalRedpandaBroker.start ()

Starts a local redpanda broker instance synchronously Returns: Redpanda
broker bootstrap server address in string format: add:port

``` python
broker = LocalRedpandaBroker(apply_nest_asyncio=True)

# Run test case only if docker is installed
if await check_docker():
    with broker:
        print("Hello world!")

    print("*" * 50 + "REDPANDA LOGS" + "+" * 50)
    redpanda_output, _ = await broker.redpanda_task.communicate()
    print(redpanda_output.decode("UTF-8"))
```

``` python
test_topic = "test-topic"
test_msg = b"test-msg"

# Run test case only if docker is installed
if await check_docker():
    with LocalRedpandaBroker(
        topics=[test_topic], apply_nest_asyncio=True
    ) as bootstrap_server:
        consumer = AIOKafkaConsumer(test_topic, bootstrap_servers=bootstrap_server)

        producer = AIOKafkaProducer(bootstrap_servers=bootstrap_server)

        await consumer.start()
        await producer.start()

        try:
            await producer.send_and_wait(test_topic, test_msg)
            msg = await consumer.getone()
            assert msg, value == test_msg
        finally:
            await consumer.stop()
            await producer.stop()
```

``` python
test_topic = "test-topic"
test_msg = b"test-msg"

# Run test case only if docker is installed
if await check_docker():
    async with LocalRedpandaBroker(topics=[test_topic]) as bootstrap_server:
        consumer = AIOKafkaConsumer(test_topic, bootstrap_servers=bootstrap_server)

        producer = AIOKafkaProducer(bootstrap_servers=bootstrap_server)

        await consumer.start()
        await producer.start()

        try:
            await producer.send_and_wait(test_topic, test_msg)
            msg = await consumer.getone()
            assert msg, value == test_msg
        finally:
            await consumer.stop()
            await producer.stop()
```
